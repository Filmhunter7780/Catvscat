<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Kia Rio 2014 — Блоки предохранителей</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
html,body{margin:0;padding:0;overflow:hidden;background:#0f172a;color:#e5e7eb;font-family:system-ui}
#ui{position:absolute;top:16px;left:16px;z-index:10;background:#020617e6;padding:14px 16px;border-radius:12px;width:360px}
button{background:#1e293b;color:#e5e7eb;border:none;padding:6px 10px;border-radius:6px;margin-right:6px;cursor:pointer}
button.active{background:#38bdf8;color:#020617}
.label{font-size:13px;color:#94a3b8}
.value{margin-bottom:10px}
</style>
</head>
<body>

<div id="ui">
  <h2>Kia Rio 2014</h2>
  <button id="btnCabin" class="active">Салон</button>
  <button id="btnEngine">Моторный отсек</button>
  <div id="info" class="label">Кликните по элементу</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<script>
/* ================= СЦЕНА ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x020617);

const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0,7,12);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.outputEncoding = THREE.sRGBEncoding;
renderer.toneMapping = THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure = 1.1;
document.body.appendChild(renderer.domElement);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

/* ================= СВЕТ ================= */
scene.add(new THREE.AmbientLight(0xffffff,0.35));
const key = new THREE.DirectionalLight(0xffffff,1.2);
key.position.set(5,10,5);
scene.add(key);

/* ================= UI ================= */
const info = document.getElementById('info');
const btnCabin = document.getElementById('btnCabin');
const btnEngine = document.getElementById('btnEngine');

/* ================= ОБЩЕЕ ================= */
let activeMeshes = [];

function clearBlock(){
  activeMeshes.forEach(m=>scene.remove(m));
  activeMeshes = [];
  info.innerHTML = 'Кликните по элементу';
}

function fuseMaterial(amps){
  const color =
    amps===10?0x991b1b:
    amps===15?0x1e40af:
    amps===20?0xfacc15:
    amps===25?0xe5e7eb:
    amps===30?0xfb923c:
    amps===40?0x16a34a:
    amps===50?0x64748b:
    0x374151;

  return new THREE.MeshPhysicalMaterial({
    color,
    roughness:0.35,
    clearcoat:0.4,
    transparent: amps==null,
    opacity: amps?1:0.35
  });
}

/* ================= МОТОРНЫЙ ОТСЕК ================= */

const engineElements = [
  {id:'F1',amps:null,desc:'Резерв'},
  {id:'F2',amps:10,desc:'Обогрев зеркал'},
  {id:'F3',amps:15,desc:'Бензонасос'},
  {id:'F4',amps:10,desc:'Звуковой сигнал'},
  {id:'F5',amps:10,desc:'Кондиционер'},
  {id:'F6',amps:null,desc:'Резерв'},
  {id:'F7',amps:null,desc:'Резерв'},
  {id:'F8',amps:15,desc:'Форсунки, ЭБУ'},
  {id:'F9',amps:10,desc:'Датчики двигателя'},
  {id:'F10',amps:10,desc:'TCM'},
  {id:'F11',amps:10,desc:'Задний ход'},
  {id:'F12',amps:null,desc:'Резерв'},
  {id:'F13',amps:null,desc:'Резерв'},

  {id:'FL1',amps:50,desc:'Распред. коробка'},
  {id:'FL2',amps:30,desc:'Вентилятор охлаждения'},
  {id:'FL3',amps:30,desc:'ЭБУ двигателя'},
  {id:'FL4',amps:40,desc:'Электронный ключ'},
  {id:'FL5',amps:50,desc:'Стартер'},

  {id:'R1',relay:true,desc:'Резерв'},
  {id:'R2',relay:true,desc:'Экстренное торможение'},
  {id:'R3',relay:true,desc:'Бензонасос'},
  {id:'R4',relay:true,desc:'Обогрев зеркал'},
  {id:'R5',relay:true,desc:'Сигнал'},
  {id:'R6',relay:true,desc:'Кондиционер'},
  {id:'R7',relay:true,desc:'Вентилятор (низкая)'},
  {id:'R8',relay:true,desc:'Резерв'},
  {id:'R9',relay:true,desc:'ЭБУ'},
  {id:'R10',relay:true,desc:'Отопитель'},
  {id:'R11',relay:true,desc:'Резерв'},
  {id:'R12',relay:true,desc:'Блокировка зажигания'},
  {id:'R13',relay:true,desc:'Вентилятор (высокая)'},
  {id:'R14',relay:true,desc:'Резерв'}
];

const engineLayout = [
  {id:'F1',x:-4,z:2},{id:'F2',x:-3,z:2},{id:'F3',x:-2,z:2},{id:'F4',x:-1,z:2},
  {id:'F5',x:0,z:2},{id:'F6',x:1,z:2},{id:'F7',x:2,z:2},{id:'F8',x:3,z:2},
  {id:'F9',x:-3,z:1},{id:'F10',x:-2,z:1},{id:'F11',x:-1,z:1},
  {id:'F12',x:0,z:1},{id:'F13',x:1,z:1},

  {id:'R1',x:-4,z:-0.5},{id:'R2',x:-3,z:-0.5},{id:'R3',x:-2,z:-0.5},
  {id:'R4',x:-1,z:-0.5},{id:'R5',x:0,z:-0.5},{id:'R6',x:1,z:-0.5},
  {id:'R7',x:2,z:-0.5},{id:'R8',x:3,z:-0.5},
  {id:'R9',x:-3,z:-1.8},{id:'R10',x:-2,z:-1.8},
  {id:'R11',x:-1,z:-1.8},{id:'R12',x:0,z:-1.8},
  {id:'R13',x:1,z:-1.8},{id:'R14',x:2,z:-1.8},

  {id:'FL1',x:-3,z:-3},{id:'FL2',x:-1.5,z:-3},
  {id:'FL3',x:0,z:-3},{id:'FL4',x:1.5,z:-3},{id:'FL5',x:3,z:-3}
];

function buildEngine(){
  clearBlock();

  const base = new THREE.Mesh(
    new THREE.BoxGeometry(10.6,0.6,7.2),
    new THREE.MeshStandardMaterial({color:0x020617,roughness:0.7})
  );
  scene.add(base);
  activeMeshes.push(base);

  engineLayout.forEach(p=>{
    const el = engineElements.find(e=>e.id===p.id);
    if(!el) return;

    let geom;
    if(el.relay){
      geom = new THREE.BoxGeometry(0.9,1.4,0.9);
    }else if(p.id.startsWith('FL')){
      geom = new THREE.BoxGeometry(1.4,1.2,1);
    }else{
      geom = new THREE.BoxGeometry(0.6,1.1,0.6);
    }

    const mesh = new THREE.Mesh(geom,fuseMaterial(el.amps));
    mesh.position.set(p.x,1,p.z);
    mesh.userData = el;
    scene.add(mesh);
    activeMeshes.push(mesh);
  });
}

/* ================= КЛИК ================= */
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener('click',e=>{
  mouse.x = (e.clientX/innerWidth)*2-1;
  mouse.y = -(e.clientY/innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hits = raycaster.intersectObjects(activeMeshes);
  if(hits.length && hits[0].object.userData){
    const f = hits[0].object.userData;
    info.innerHTML = `<b>${f.id}</b><br>${f.amps||'-'} A<br>${f.desc}`;
  }
});

/* ================= КНОПКИ ================= */
btnEngine.onclick = ()=>{
  btnEngine.classList.add('active');
  btnCabin.classList.remove('active');
  buildEngine();
};

/* ================= СТАРТ ================= */
buildEngine();

/* ================= ЦИКЛ ================= */
function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}
animate();

window.addEventListener('resize',()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth, innerHeight);
});
</script>
</body>
</html>
